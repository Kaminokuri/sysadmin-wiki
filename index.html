<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wiki Sysadmin - Documentation Technique</title>
    <meta name="description" content="Wiki technique dédié à l'administration système, la cybersécurité et l'infrastructure IT">
    <meta name="keywords" content="sysadmin, windows server, linux, cybersécurité, infrastructure, documentation">
    <meta name="author" content="Mathéo Fauvel">
    
    <style>
        /* Variables CSS */
        :root {
            --primary-color: #2563eb;
            --primary-dark: #1d4ed8;
            --secondary-color: #f8fafc;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --sidebar-width: 280px;
            --header-height: 70px;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --info-color: #3b82f6;
        }

        /* Reset et base */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-primary);
            background-color: #ffffff;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: var(--header-height);
            background: linear-gradient(135deg, var(--primary-color), var(--primary-dark));
            color: white;
            display: flex;
            align-items: center;
            padding: 0 2rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
        }

        .header h1 {
            font-size: 1.5rem;
            font-weight: 600;
            margin: 0;
            flex-shrink: 0;
        }

        /* Barre de recherche dans le header */
        .header-search-container {
            flex: 1;
            display: flex;
            justify-content: center;
            padding: 0 2rem;
            max-width: 500px;
            margin: 0 auto;
        }

        .header-search-box {
            position: relative;
            width: 100%;
        }

        .header-search-box input {
            width: 100%;
            padding: 8px 16px;
            border: none;
            border-radius: 20px;
            background: rgba(255, 255, 255, 0.15);
            color: white;
            font-size: 0.9rem;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            outline: none;
        }

        .header-search-box input::placeholder {
            color: rgba(255, 255, 255, 0.7);
        }

        .header-search-box input:focus {
            background: rgba(255, 255, 255, 0.25);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.3);
        }

        /* Résultats de recherche dans le header */
        .header-search-box .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            max-height: 400px;
            overflow-y: auto;
            z-index: 1001;
            display: none;
            margin-top: 8px;
        }

        .header-search-box .search-results.visible {
            display: block;
        }

        /* Styles des éléments de résultats dans le header */
        .header-search-box .search-result-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .header-search-box .search-result-item:last-child {
            border-bottom: none;
        }

        .header-search-box .search-result-item:hover {
            background-color: rgba(37, 99, 235, 0.05);
        }

        .header-search-box .search-result-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .header-search-box .search-result-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .header-search-box .search-result-category {
            font-size: 0.675rem;
            color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.1);
            padding: 0.125rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
        }

        .header-search-box .search-no-results {
            padding: 1rem;
            text-align: center;
            color: var(--text-secondary);
        }

        /* Container principal */
        .container {
            display: flex;
            margin-top: var(--header-height);
            min-height: calc(100vh - var(--header-height));
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--secondary-color);
            border-right: 1px solid var(--border-color);
            overflow-y: auto;
            position: fixed;
            height: calc(100vh - var(--header-height));
            top: var(--header-height);
            left: 0;
            z-index: 100;
        }

        /* Recherche */
        .search-container {
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
            background-color: white;
        }

        .search-box {
            position: relative;
        }

        #searchInput {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.875rem;
            background-color: white;
            transition: all 0.2s ease;
        }

        #searchInput:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: white;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            max-height: 300px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .search-results.visible {
            display: block;
        }

        .search-result-item {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid var(--border-color);
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .search-result-item:last-child {
            border-bottom: none;
        }

        .search-result-item:hover {
            background-color: rgba(37, 99, 235, 0.05);
        }

        .search-result-title {
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .search-result-description {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-bottom: 0.25rem;
        }

        .search-result-category {
            font-size: 0.675rem;
            color: var(--primary-color);
            background-color: rgba(37, 99, 235, 0.1);
            padding: 0.125rem 0.5rem;
            border-radius: 12px;
            display: inline-block;
        }

        .search-no-results {
            padding: 1rem;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .nav {
            padding: 1rem 0;
        }

        .nav-section {
            margin-bottom: 1.5rem;
        }

        .nav-header {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 0.5rem;
        }

        .nav-item {
            position: relative;
        }

        .nav-link {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.75rem 1rem;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
        }

        .nav-link:hover {
            background-color: rgba(37, 99, 235, 0.1);
            border-left-color: var(--primary-color);
        }

        .nav-link.active {
            background-color: rgba(37, 99, 235, 0.15);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }

        .badge {
            background-color: var(--primary-color);
            color: white;
            font-size: 0.75rem;
            padding: 0.125rem 0.5rem;
            border-radius: 12px;
            font-weight: 500;
        }

        /* Sous-menus */
        .nav-item.has-submenu .nav-toggle {
            font-size: 0.75rem;
            transition: transform 0.2s ease;
        }

        .submenu {
            background-color: rgba(255, 255, 255, 0.7);
            border-left: 2px solid var(--border-color);
            margin-left: 1rem;
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .submenu.expanded {
            max-height: 200px;
        }

        .submenu-item {
            display: block;
            padding: 0.5rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .submenu-item:hover {
            background-color: rgba(37, 99, 235, 0.1);
            color: var(--primary-color);
        }

        /* Contenu principal */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            padding: 2rem;
            max-width: calc(100vw - var(--sidebar-width));
        }

        /* Breadcrumb */
        .breadcrumb {
            margin-bottom: 1.5rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        .breadcrumb-item {
            color: var(--text-secondary);
            text-decoration: none;
        }

        .breadcrumb-item:hover {
            color: var(--primary-color);
        }

        .breadcrumb-item.active {
            color: var(--text-primary);
            font-weight: 500;
        }

        .breadcrumb-separator {
            margin: 0 0.5rem;
        }

        /* En-tête du contenu */
        .content-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .content-header h1 {
            font-size: 2.25rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
        }

        .meta-item {
            font-size: 0.875rem;
            color: var(--text-secondary);
        }

        /* Contenu */
        .content {
            line-height: 1.8;
        }

        .content h2 {
            font-size: 1.75rem;
            font-weight: 600;
            margin: 2rem 0 1rem 0;
            color: var(--text-primary);
        }

        .content h3 {
            font-size: 1.375rem;
            font-weight: 600;
            margin: 1.5rem 0 0.75rem 0;
            color: var(--text-primary);
        }

        .content p {
            margin-bottom: 1rem;
        }

        .content ul, .content ol {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .content li {
            margin-bottom: 0.5rem;
        }

        /* Code */
        .content pre {
            background-color: #f8fafc;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1rem;
            overflow-x: auto;
            margin: 1rem 0;
            font-family: 'Fira Code', 'Monaco', 'Menlo', monospace;
            font-size: 0.875rem;
        }

        .content code {
            background-color: #f1f5f9;
            padding: 0.125rem 0.25rem;
            border-radius: 4px;
            font-family: 'Fira Code', 'Monaco', 'Menlo', monospace;
            font-size: 0.875rem;
        }

        .content pre code {
            background: none;
            padding: 0;
        }

        /* Tableaux */
        .content table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        .content th,
        .content td {
            border: 1px solid var(--border-color);
            padding: 0.75rem;
            text-align: left;
        }

        .content th {
            background-color: var(--secondary-color);
            font-weight: 600;
        }

        /* Blockquotes */
        .content blockquote {
            border-left: 4px solid var(--info-color);
            background-color: #f0f9ff;
            padding: 1rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .content blockquote.warning {
            border-left-color: var(--warning-color);
            background-color: #fffbeb;
        }

        .content blockquote.error {
            border-left-color: var(--error-color);
            background-color: #fef2f2;
        }

        .content blockquote.tip {
            border-left-color: var(--success-color);
            background-color: #f0fdf4;
        }

        /* Liens */
        .content a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .content a:hover {
            text-decoration: underline;
        }

        /* Mobile Toggle */
        .mobile-toggle {
            display: none;
            position: fixed;
            top: 50%;
            left: 1rem;
            transform: translateY(-50%);
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            font-size: 1.25rem;
            cursor: pointer;
            z-index: 1001;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
                max-width: 100vw;
                padding: 1rem;
            }

            .mobile-toggle {
                display: block;
            }

            .content-header h1 {
                font-size: 1.875rem;
            }

            /* Barre de recherche header responsive */
            .header {
                padding: 0 1rem;
                flex-wrap: wrap;
                min-height: var(--header-height);
                height: auto;
            }

            .header h1 {
                font-size: 1.25rem;
                margin-bottom: 0.5rem;
                order: 1;
                width: 100%;
            }

            .header-search-container {
                order: 2;
                padding: 0;
                max-width: none;
                margin: 0;
                width: 100%;
                margin-bottom: 0.5rem;
            }

            .header-search-box input {
                padding: 6px 12px;
                font-size: 0.85rem;
            }

            .header > div:last-child {
                order: 3;
                margin-left: 0;
                text-align: center;
                width: 100%;
            }

            .meta {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            /* Recherche mobile */
            .search-container {
                padding: 0.75rem;
            }

            #searchInput {
                font-size: 1rem;
            }

            .search-results {
                max-height: 250px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <h1>🛡️ Wiki Sysadmin</h1>
        
        <!-- Barre de recherche au centre -->
        <div class="header-search-container">
            <div class="header-search-box">
                <input type="text" id="searchInput" placeholder="🔍 Rechercher..." autocomplete="off">
                <div id="searchResults" class="search-results"></div>
        </div>
        </div>
        
        <div style="margin-left: auto; text-align: right;">
            <div style="font-size: 0.9rem; opacity: 0.9;">Documentation Technique</div>
            <div style="font-size: 0.9rem; color: rgba(255,255,255,0.8);">Mathéo Fauvel</div>
        </div>
    </header>

    <div class="container">
        <aside class="sidebar" id="sidebar">
            <!-- 🤖 SIDEBAR AUTO-GÉNÉRÉE - Chargement en cours... -->
            <div id="sidebar-loading" style="padding: 2rem; text-align: center; color: #666;">
                <div style="margin-bottom: 1rem;">🔄</div>
                <div>Chargement de la navigation...</div>
            </div>
            
            <button class="mobile-toggle" onclick="toggleSidebar()">☰</button>
        </aside>

        <main class="main-content">
            <div class="breadcrumb">
                <a href="#" class="breadcrumb-item">Accueil</a>
                <span class="breadcrumb-separator">›</span>
                <span class="breadcrumb-item active">Windows Server 2022</span>
            </div>

            <div class="content-header">
                <h1>Windows Server 2022</h1>
                <div class="meta">
                    <span class="badge">Administration Système</span>
                    <span class="meta-item">📖 15 min de lecture</span>
                    <span class="meta-item">🔄 Mis à jour le 31 juillet 2025</span>
                    <span class="meta-item">👤 Mathéo Fauvel</span>
                </div>
            </div>

            <div class="content">
                <blockquote>
                    <p><strong>Note:</strong> Cette documentation couvre Windows Server 2022 et ses principales fonctionnalités pour l'administration système en entreprise.</p>
                </blockquote>

                <h2>Introduction</h2>
                <p>Windows Server 2022 est la dernière version du système d'exploitation serveur de Microsoft, offrant des améliorations significatives en termes de sécurité, de performances et de gestion hybride. Cette plateforme constitue le socle de nombreuses infrastructures d'entreprise modernes.</p>

                <h2>Configuration Initiale</h2>
                <p>La configuration initiale d'un serveur Windows est une étape cruciale qui détermine la sécurité et les performances futures du système. Voici les étapes essentielles à suivre après l'installation.</p>

                <h3>1. Configuration réseau</h3>
                <pre><code class="language-powershell">New-NetIPAddress -InterfaceAlias "Ethernet" -IPAddress 192.168.1.10 -PrefixLength 24 -DefaultGateway 192.168.1.1
Set-DnsClientServerAddress -InterfaceAlias "Ethernet" -ServerAddresses 192.168.1.1, 8.8.8.8
Test-NetConnection google.com</code></pre>

                <h3>2. Sécurisation du serveur</h3>
                <ul>
                    <li>Activation du pare-feu Windows avec règles personnalisées</li>
                    <li>Configuration des stratégies de mot de passe complexes</li>
                    <li>Mise en place de l'audit des événements de sécurité</li>
                    <li>Installation des dernières mises à jour de sécurité</li>
                </ul>

                <h2>Rôles et Fonctionnalités</h2>
                <p>Windows Server 2022 propose une variété de rôles serveur qui peuvent être installés selon les besoins de votre infrastructure. Les rôles les plus couramment déployés incluent :</p>

                <table>
                    <thead>
                        <tr>
                            <th>Rôle</th>
                            <th>Description</th>
                            <th>Port(s)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Active Directory DS</td>
                            <td>Services de domaine pour l'authentification centralisée</td>
                            <td>389, 636, 3268</td>
                        </tr>
                        <tr>
                            <td>DNS Server</td>
                            <td>Résolution de noms pour le réseau</td>
                            <td>53</td>
                        </tr>
                        <tr>
                            <td>DHCP Server</td>
                            <td>Attribution automatique d'adresses IP</td>
                            <td>67, 68</td>
                        </tr>
                        <tr>
                            <td>File Services</td>
                            <td>Partage de fichiers et gestion du stockage</td>
                            <td>445, 139</td>
                        </tr>
                    </tbody>
                </table>

                <h2>PowerShell pour l'Administration</h2>
                <p>PowerShell est l'outil de prédilection pour l'automatisation et la gestion à grande échelle des serveurs Windows. Voici quelques commandes essentielles :</p>

                <pre><code class="language-powershell"># Obtenir les informations système
Get-ComputerInfo | Select-Object CsName, OsName, OsVersion, OsArchitecture

# Lister les services en cours d'exécution
Get-Service | Where-Object {$_.Status -eq "Running"} | Select-Object Name, DisplayName

# Créer un nouvel utilisateur local
New-LocalUser -Name "AdminTest" -Password (ConvertTo-SecureString "P@ssw0rd123!" -AsPlainText -Force) -PasswordNeverExpires

# Vérifier l'espace disque
Get-PSDrive -PSProvider FileSystem | Select-Object Name, @{n="Size(GB)";e={[math]::Round($_.Used/1GB,2)}}, @{n="Free(GB)";e={[math]::Round($_.Free/1GB,2)}}</code></pre>

                <blockquote class="warning">
                    <p><strong>Attention:</strong> Toujours tester les scripts PowerShell dans un environnement de test avant de les exécuter en production.</p>
                </blockquote>

                <h2>Monitoring et Maintenance</h2>
                <p>La surveillance proactive est essentielle pour maintenir la santé et les performances de vos serveurs Windows. Les outils natifs incluent :</p>

                <ul>
                    <li><code>Performance Monitor (perfmon)</code> - Analyse détaillée des performances</li>
                    <li><code>Event Viewer</code> - Journalisation et analyse des événements</li>
                    <li><code>Resource Monitor</code> - Vue en temps réel de l'utilisation des ressources</li>
                    <li><code>Windows Admin Center</code> - Interface web moderne pour la gestion</li>
                </ul>

                <h2>Bonnes Pratiques de Sécurité</h2>
                <p><strong>Recommandations:</strong></p>
                <ul>
                        <li>Appliquer le principe du moindre privilège</li>
                        <li>Activer BitLocker pour le chiffrement des disques</li>
                        <li>Configurer Windows Defender et l'ATP</li>
                        <li>Mettre en place une stratégie de sauvegarde 3-2-1</li>
                        <li>Auditer régulièrement les accès et permissions</li>
                    </ul>

                <h2>Ressources Complémentaires</h2>
                <p>Pour approfondir vos connaissances sur Windows Server 2022, consultez les ressources suivantes :</p>

                <ul>
                    <li><a href="#">Documentation officielle Microsoft</a></li>
                    <li><a href="#">Guide de déploiement Windows Server</a></li>
                    <li><a href="#">Meilleures pratiques de sécurité</a></li>
                    <li><a href="#">Scripts PowerShell pour l'administration</a></li>
                </ul>
            </div>
        </main>
    </div>

    <div class="mobile-toggle" id="mobileToggle">
        ☰
    </div>

    <!-- Marked.js for Markdown parsing -->
    <script src="https://cdn.jsdelivr.net/npm/marked@4.3.0/marked.min.js"></script>
    <!-- Prism.js for syntax highlighting -->
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script>
        // Système hybride : Sidebar statique + Contenu Markdown
        
        // Configuration de Marked.js
        marked.setOptions({
            breaks: true,
            gfm: true,
            highlight: function(code, lang) {
                if (Prism.languages[lang]) {
                    return Prism.highlight(code, Prism.languages[lang], lang);
                }
                return code;
            }
        });

        // 🚀 SYSTÈME AUTO-DÉCOUVERTE 100% MARKDOWN
        // Plus besoin de modifier HTML ou JavaScript pour ajouter des articles !

        // Variables globales
        let articlesDatabase = {};
        let searchIndex = {};
        let navigationStructure = {};

        // 🔄 AUTO-DÉCOUVERTE DES ARTICLES DEPUIS NAVIGATION.MD
        async function discoverArticles() {
            console.log('🔍 Découverte automatique depuis navigation.md...');
            
            try {
                // Charger le fichier de navigation
                const navResponse = await fetch('content/navigation.md');
                if (!navResponse.ok) {
                    throw new Error('Fichier navigation.md non trouvé');
                }
                
                const navContent = await navResponse.text();
                console.log('📄 Navigation.md chargé');
                
                // Parser la navigation Markdown
                const navigationConfig = parseNavigationMarkdown(navContent);
                console.log('📋 Configuration navigation parsée:', navigationConfig);
                
                // Initialiser les structures
                navigationStructure = {};
                articlesDatabase = {};
                searchIndex = {};
                
                // Traiter chaque section
                for (const section of navigationConfig) {
                    const sectionKey = generateSectionKey(section.title);
                    navigationStructure[sectionKey] = {
                        title: section.title,
                        icon: section.icon,
                        order: section.order,
                        articles: [],
                        submenus: {},
                        rawConfig: section // Garder la config originale pour la génération
                    };
                    
                    // Traiter tous les fichiers de cette section
                    const allFiles = collectAllFiles(section);
                    for (const filePath of allFiles) {
                        await processMarkdownFile(`content/${filePath}`, sectionKey);
                    }
                    
                    // Organiser les sous-menus correctement
                    for (const article of section.articles) {
                        const articleId = generateArticleId(`content/${article.filePath}`);
                        
                        if (article.subArticles && article.subArticles.length > 0) {
                            // Créer le sous-menu en utilisant l'articleId complet
                            navigationStructure[sectionKey].submenus[articleId] = [];
                            
                            for (const subArticle of article.subArticles) {
                                const subArticleId = generateArticleId(`content/${subArticle.filePath}`);
                                navigationStructure[sectionKey].submenus[articleId].push(subArticleId);
                            }
                            
                            console.log(`📂 Sous-menu créé pour ${articleId}:`, navigationStructure[sectionKey].submenus[articleId]);
                        }
                        
                        // Ajouter l'article principal
                        if (!navigationStructure[sectionKey].articles.includes(articleId)) {
                            navigationStructure[sectionKey].articles.push(articleId);
                        }
                    }
                }
                
                console.log('✅ Découverte terminée:', navigationStructure);
                console.log('📊 Articles:', Object.keys(articlesDatabase).length);
                console.log('🔍 Index recherche:', Object.keys(searchIndex).length);
                
                return true;
                
            } catch (error) {
                console.error('❌ Erreur lors de la découverte:', error);
                // Fallback vers la configuration par défaut si navigation.md n'existe pas
                return await discoverArticlesClassic();
            }
        }
        
        // 📜 PARSER LA NAVIGATION MARKDOWN
        function parseNavigationMarkdown(content) {
            console.log('🔍 Parsing du fichier navigation.md...');
            
            const lines = content.split('\n');
            const sections = [];
            let currentSection = null;
            let currentArticle = null;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                
                // Section principale (## Titre)
                if (line.startsWith('## ') && !line.startsWith('### ')) {
                    currentSection = {
                        title: line.substring(3).trim(),
                        icon: extractIcon(line),
                        order: extractOrder(lines, i) || sections.length + 1,
                        articles: []
                    };
                    sections.push(currentSection);
                    currentArticle = null;
                }
                // Article avec sous-articles (### Titre)
                else if (line.startsWith('### ') && currentSection) {
                    const articleTitle = line.substring(4).trim();
                    const filePath = extractFilePath(articleTitle, lines, i);
                    const badge = extractBadge(lines, i);
                    
                    currentArticle = {
                        title: cleanTitle(articleTitle),
                        filePath: filePath,
                        badge: badge,
                        subArticles: []
                    };
                    currentSection.articles.push(currentArticle);
                }
                // Sous-article (- [Titre](chemin))
                else if (line.startsWith('- [') && currentArticle) {
                    const match = line.match(/- \[([^\]]+)\]\(([^)]+)\)/);
                    if (match) {
                        currentArticle.subArticles.push({
                            title: match[1],
                            filePath: match[2]
                        });
                    }
                }
            }
            
            return sections;
        }
        
        // Utilitaires pour parser la navigation
        function extractIcon(line) {
            const iconMatch = line.match(/([🎯⚙️🔒🏗️📋🚀🔧📊🌐💻📱🔄🎨📝🔍]+)/);
            return iconMatch ? iconMatch[1] : '📄';
        }
        
        function extractOrder(lines, currentIndex) {
            // Chercher un commentaire ordre sur les lignes suivantes
            for (let i = currentIndex + 1; i < Math.min(currentIndex + 3, lines.length); i++) {
                const line = lines[i];
                const orderMatch = line.match(/<!--.*order:\s*(\d+)/);
                if (orderMatch) {
                    return parseInt(orderMatch[1]);
                }
            }
            return null;
        }
        
        function extractFilePath(title, lines, currentIndex) {
            // Si le titre contient déjà un lien markdown
            const linkMatch = title.match(/\[([^\]]+)\]\(([^)]+)\)/);
            if (linkMatch) {
                return linkMatch[2];
            }
            
            // Chercher un commentaire file sur les lignes suivantes
            for (let i = currentIndex + 1; i < Math.min(currentIndex + 3, lines.length); i++) {
                const line = lines[i];
                const fileMatch = line.match(/<!--.*file:\s*([^,\s>]+)/);
                if (fileMatch) {
                    return fileMatch[1];
                }
            }
            
            // Générer automatiquement depuis le titre
            return generateFilePathFromTitle(title);
        }
        
        function extractBadge(lines, currentIndex) {
            for (let i = currentIndex + 1; i < Math.min(currentIndex + 3, lines.length); i++) {
                const line = lines[i];
                const badgeMatch = line.match(/<!--.*badge:\s*([^,\s>]+)|badge:\s*([^,\s>]+)/);
                if (badgeMatch) {
                    return badgeMatch[1] || badgeMatch[2];
                }
            }
            return null;
        }
        
        function cleanTitle(title) {
            // Supprimer les liens markdown pour garder juste le titre
            const linkMatch = title.match(/\[([^\]]+)\]/);
            return linkMatch ? linkMatch[1] : title;
        }
        
        function generateSectionKey(title) {
            return title.toLowerCase()
                .replace(/[🎯⚙️🔒🏗️📋🚀🔧📊🌐💻📱🔄🎨📝🔍\s]+/g, '')
                .replace(/\s+/g, '-')
                .replace(/[^\w-]/g, '');
        }
        
        function generateFilePathFromTitle(title) {
            const cleanTitle = title.replace(/[🎯⚙️🔒🏗️📋🚀🔧📊🌐💻📱🔄🎨📝🔍\[\]()]/g, '').trim();
            return cleanTitle.toLowerCase()
                .replace(/\s+/g, '-')
                .replace(/[^\w-]/g, '') + '.md';
        }
        
        function collectAllFiles(section) {
            const files = [];
            for (const article of section.articles) {
                if (article.filePath) {
                    files.push(article.filePath);
                }
                for (const subArticle of article.subArticles) {
                    files.push(subArticle.filePath);
                }
            }
            return files;
        }
        
        // Traiter un fichier Markdown
        async function processMarkdownFile(filePath, sectionKey) {
            console.log(`📄 Traitement ${filePath}...`);
            
            try {
                const response = await fetch(filePath);
                if (!response.ok) {
                    console.warn(`⚠️ Fichier non trouvé: ${filePath}`);
                    return;
                }
                
                const content = await response.text();
                const { metadata, content: markdownContent } = parseFrontMatter(content);
                
                // Générer l'ID de l'article
                const articleId = generateArticleId(filePath);
                
                // Détecter si c'est un sous-article
                const pathParts = filePath.split('/');
                const isSubArticle = pathParts.length > 3;
                const parentFolder = isSubArticle ? pathParts[pathParts.length - 2] : null;
                
                // Stocker l'article
                articlesDatabase[articleId] = {
                    id: articleId,
                    filePath: filePath,
                    title: metadata.title || extractTitleFromContent(markdownContent),
                    description: metadata.description || '',
                    category: metadata.category || navigationStructure[sectionKey].title,
                    tags: parseTags(metadata.tags),
                    level: metadata.level || 'Intermédiaire',
                    author: metadata.author || 'Mathéo Fauvel',
                    lastUpdated: metadata.last_updated || new Date().toLocaleDateString('fr-FR'),
                    readingTime: metadata.reading_time || estimateReadingTime(markdownContent),
                    sectionKey: sectionKey,
                    isSubArticle: isSubArticle,
                    parentFolder: parentFolder,
                    order: metadata.order || 999
                };
                
                // Créer l'entrée de recherche
                searchIndex[articleId] = {
                    title: articlesDatabase[articleId].title,
                    description: articlesDatabase[articleId].description,
                    category: articlesDatabase[articleId].category,
                    tags: articlesDatabase[articleId].tags,
                    keywords: generateKeywords(metadata, markdownContent, articlesDatabase[articleId].title)
                };
                
                // Organiser dans la navigation
                if (isSubArticle && parentFolder) {
                    // C'est un sous-article
                    if (!navigationStructure[sectionKey].submenus[parentFolder]) {
                        navigationStructure[sectionKey].submenus[parentFolder] = [];
                    }
                    navigationStructure[sectionKey].submenus[parentFolder].push(articleId);
                } else {
                    // C'est un article principal
                    navigationStructure[sectionKey].articles.push(articleId);
                }
                
                console.log(`✅ Article traité: ${articleId}`);
                
            } catch (error) {
                console.error(`❌ Erreur traitement ${filePath}:`, error);
            }
        }

        // 🎨 GÉNÉRATION AUTOMATIQUE DE LA SIDEBAR AVEC SOUS-MENUS
        function generateSidebar() {
            console.log('🎨 Génération automatique de la sidebar avec sous-menus...');
            
            const sidebar = document.getElementById('sidebar');
            const loadingDiv = document.getElementById('sidebar-loading');
            
            if (!sidebar) {
                console.error('❌ Sidebar non trouvée');
                return;
            }
            
            // Supprimer le message de chargement
            if (loadingDiv) {
                loadingDiv.remove();
            }
            
            let sidebarHTML = '';
            
            // Générer depuis navigationStructure qui contient maintenant les sous-menus
            const sortedSections = Object.entries(navigationStructure)
                .sort(([,a], [,b]) => a.order - b.order);
            
            for (const [sectionKey, section] of sortedSections) {
                sidebarHTML += `
                    <nav class="nav">
                        <div class="nav-section">
                            <h3 class="nav-header">${section.title}</h3>
                `;
                
                // Articles principaux
                for (const articleId of section.articles) {
                    const article = articlesDatabase[articleId];
                    if (!article) continue;
                    
                    // Vérifier s'il a des sous-articles en utilisant l'articleId complet
                    const hasSubmenu = section.submenus[articleId] && section.submenus[articleId].length > 0;
                    
                    console.log(`🔍 Article ${articleId}: hasSubmenu=${hasSubmenu}, submenus=`, section.submenus[articleId] || 'aucun');
                    
                    if (hasSubmenu) {
                        // Article avec sous-menu
                        sidebarHTML += `
                            <div class="nav-item has-submenu">
                                <a href="#" onclick="loadAutoMarkdownArticle('${articleId}')" class="nav-link">
                                    <span>${article.title}</span>
                                    <span class="nav-toggle">▼</span>
                                </a>
                                <div class="submenu">
                        `;
                        
                        // Sous-articles
                        for (const subArticleId of section.submenus[articleId]) {
                            const subArticle = articlesDatabase[subArticleId];
                            if (subArticle) {
                                sidebarHTML += `
                                    <a href="#" onclick="loadAutoMarkdownArticle('${subArticleId}')" class="submenu-item">
                                        <span>${subArticle.title}</span>
                                    </a>
                                `;
                            }
                        }
                        
                        sidebarHTML += `
                                </div>
                            </div>
                        `;
                    } else {
                        // Article simple
                        sidebarHTML += `
                            <div class="nav-item">
                                <a href="#" onclick="loadAutoMarkdownArticle('${articleId}')" class="nav-link">
                                    <span>${article.title}</span>
                                </a>
                            </div>
                        `;
                    }
                }
                
                sidebarHTML += `
                        </div>
                    </nav>
                `;
            }
            
            // Ajouter le bouton mobile à la fin
            sidebarHTML += '<button class="mobile-toggle" onclick="toggleSidebar()">☰</button>';
            
            sidebar.innerHTML = sidebarHTML;
            console.log('✅ Sidebar générée avec sous-menus:', Object.keys(navigationStructure).map(k => navigationStructure[k].submenus));
        }
        
        // 🔄 Génération sidebar classique (fallback)
        function generateSidebarClassic() {
            console.log('🔄 Génération sidebar classique (fallback)...');
            
            const sidebar = document.getElementById('sidebar');
            if (!sidebar) return;
            
            let sidebarHTML = '';
            
            // Générer depuis navigationStructure (ancien système)
            const sortedSections = Object.entries(navigationStructure)
                .sort(([,a], [,b]) => a.order - b.order);
            
            for (const [sectionKey, section] of sortedSections) {
                sidebarHTML += `
                    <nav class="nav">
                        <div class="nav-section">
                            <h3 class="nav-header">${section.title}</h3>
                `;
                
                // Articles principaux
                for (const articleId of section.articles) {
                    const article = articlesDatabase[articleId];
                    if (!article) continue;
                    
                    sidebarHTML += `
                        <div class="nav-item">
                            <a href="#" onclick="loadAutoMarkdownArticle('${articleId}')" class="nav-link">
                                <span>${article.title}</span>
                            </a>
                        </div>
                    `;
                }
                
                sidebarHTML += `
                        </div>
                    </nav>
                `;
            }
            
            sidebarHTML += '<button class="mobile-toggle" onclick="toggleSidebar()">☰</button>';
            sidebar.innerHTML = sidebarHTML;
            console.log('✅ Sidebar classique générée (fallback)');
        }

        // Utilitaires
        function generateArticleId(filePath) {
            return filePath
                .replace('content/', '')
                .replace('.md', '')
                .replace(/\//g, '-')
                .toLowerCase();
        }
        
        function parseTags(tags) {
            if (Array.isArray(tags)) return tags;
            if (typeof tags === 'string') {
                if (tags.startsWith('[')) {
                    try {
                        return JSON.parse(tags);
                    } catch {
                        return tags.split(',').map(t => t.trim());
                    }
                }
                return tags.split(',').map(t => t.trim());
            }
            return [];
        }
        
        function extractTitleFromContent(content) {
            const lines = content.split('\n');
            for (const line of lines) {
                if (line.startsWith('# ')) {
                    return line.substring(2).trim();
                }
            }
            return 'Article sans titre';
        }
        
        function estimateReadingTime(content) {
            const words = content.split(/\s+/).length;
            const minutes = Math.ceil(words / 200); // 200 mots par minute
            return `${minutes} min`;
        }
        
        function generateKeywords(metadata, content, title) {
            const keywords = new Set();
            
            // Titre
            if (title) {
                title.toLowerCase().split(/\s+/).forEach(word => {
                    if (word.length > 2) keywords.add(word);
                });
            }
            
            // Description
            if (metadata.description) {
                metadata.description.toLowerCase().split(/\s+/).forEach(word => {
                    if (word.length > 2) keywords.add(word);
                });
            }
            
            // Tags
            const tags = parseTags(metadata.tags);
            tags.forEach(tag => {
                if (typeof tag === 'string') {
                    tag.toLowerCase().split(/\s+/).forEach(word => {
                        if (word.length > 2) keywords.add(word);
                    });
                }
            });
            
            // Mots-clés explicites
            if (metadata.keywords) {
                metadata.keywords.toLowerCase().split(/\s+/).forEach(word => {
                    if (word.length > 2) keywords.add(word);
                });
            }
            
            return Array.from(keywords).join(' ');
        }

        // Variable pour l'article actuel
        let currentArticle = 'sysadmin-windows-server';

        // 📄 NOUVEAU CHARGEMENT D'ARTICLE AUTO
        async function loadAutoMarkdownArticle(articleId) {
            console.log(`📖 Chargement auto de l'article: ${articleId}`);
            
            // Récupérer l'article de la base de données
            const article = articlesDatabase[articleId];
            if (!article) {
                console.error(`❌ Article non trouvé: ${articleId}`);
                showErrorMessage(`Article "${articleId}" non trouvé.`);
                return;
            }
            
            try {
                console.log(`📁 Chargement depuis: ${article.filePath}`);
                
                const response = await fetch(article.filePath);
                if (!response.ok) {
                    throw new Error(`Erreur ${response.status}: ${response.statusText}`);
                }
                
                const markdownContent = await response.text();
                console.log(`📄 Contenu chargé (${markdownContent.length} caractères)`);
                
                const { metadata, content } = parseFrontMatter(markdownContent);
                console.log('📋 Métadonnées extraites:', metadata);
                
                const htmlContent = marked.parse(content);
                console.log('🔄 HTML généré');
                
                updateContent(articleId, article, htmlContent);
                updateActiveNavItem(articleId);
                updateUrl(articleId);
                
                console.log(`✅ Article "${articleId}" chargé avec succès`);
                
            } catch (error) {
                console.error(`❌ Erreur lors du chargement de l'article ${articleId}:`, error);
                showErrorMessage(`Impossible de charger l'article demandé.`);
            }
        }

        // 🔍 NOUVELLE FONCTION DE RECHERCHE AUTO
        function performAutoSearch(query) {
            console.log(`🔍 Recherche automatique pour: "${query}"`);
            
            if (query.length < 2) {
                console.log('❌ Requête trop courte');
                hideSearchResults();
                return;
            }

            query = query.toLowerCase().trim();
            const results = [];
            console.log(`📝 Recherche dans ${Object.keys(searchIndex).length} articles...`);

            // Rechercher dans l'index auto-généré
            Object.entries(searchIndex).forEach(([articleId, data]) => {
                let score = 0;
                const searchText = `${data.title} ${data.description} ${data.category} ${data.keywords} ${data.tags.join(' ')}`.toLowerCase();

                // Score basé sur la correspondance
                if (data.title.toLowerCase().includes(query)) score += 10;
                if (data.description.toLowerCase().includes(query)) score += 5;
                if (data.category.toLowerCase().includes(query)) score += 8;
                if (data.keywords.toLowerCase().includes(query)) score += 6;
                if (data.tags.some(tag => tag.toLowerCase().includes(query))) score += 7;

                // Recherche de mots individuels
                const queryWords = query.split(' ');
                queryWords.forEach(word => {
                    if (word.length > 2 && searchText.includes(word)) {
                        score += 2;
                    }
                });

                if (score > 0) {
                    results.push({
                        articleId,
                        ...data,
                        score
                    });
                }
            });

            // Trier par score décroissant
            results.sort((a, b) => b.score - a.score);
            console.log(`✅ ${results.length} résultats trouvés:`, results.map(r => ({title: r.title, score: r.score})));

            // Limiter à 8 résultats
            const limitedResults = results.slice(0, 8);
            console.log(`📋 Affichage de ${limitedResults.length} résultats`);

            displaySearchResults(limitedResults, query);
        }

        // Charger un article Markdown (ANCIENNE VERSION - Compatibilité)
        async function loadMarkdownArticle(articleId) {
            try {
                console.log(`🔍 Chargement de l'article: ${articleId}`);
                
                const filePath = articlesMapping[articleId];
                if (!filePath) {
                    throw new Error(`Article non trouvé: ${articleId}`);
                }
                
                const response = await fetch(filePath);
                if (!response.ok) {
                    throw new Error(`Erreur ${response.status}: ${response.statusText}`);
                }
                
                const markdownContent = await response.text();
                console.log(`📄 Contenu brut chargé (${markdownContent.length} caractères):`, markdownContent.substring(0, 200) + '...');
                
                const { metadata, content } = parseFrontMatter(markdownContent);
                console.log('📋 Métadonnées extraites:', metadata);
                console.log('📝 Contenu Markdown extrait:', content.substring(0, 200) + '...');
                
                const htmlContent = marked.parse(content);
                console.log('🔄 HTML généré:', htmlContent.substring(0, 200) + '...');
                
                updateContent(articleId, metadata, htmlContent);
                updateActiveNavItem(articleId);
                updateUrl(articleId);
                
                currentArticle = articleId;
                console.log('✅ Article chargé avec succès!');
                
            } catch (error) {
                console.error(`❌ Erreur lors du chargement de l'article ${articleId}:`, error);
                showErrorMessage(`Impossible de charger l'article demandé.`);
            }
        }

        // Parser le front matter YAML
        function parseFrontMatter(markdown) {
            // Normaliser les fins de ligne et chercher le pattern front matter
            const normalizedMarkdown = markdown.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            const frontMatterMatch = normalizedMarkdown.match(/^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/);
            
            if (!frontMatterMatch) {
                console.warn('Pas de front matter trouvé, retour du contenu complet');
                return { metadata: {}, content: markdown };
            }
            
            const [, frontMatter, content] = frontMatterMatch;
            const metadata = {};
            
            // Parser chaque ligne du front matter
            frontMatter.split('\n').forEach(line => {
                line = line.trim();
                if (line && !line.startsWith('#')) {
                    const match = line.match(/^([a-zA-Z_][a-zA-Z0-9_]*)\s*:\s*(.+)$/);
                    if (match) {
                        const [, key, value] = match;
                        // Nettoyer les guillemets et crochets
                        let cleanValue = value.trim();
                        if ((cleanValue.startsWith('"') && cleanValue.endsWith('"')) ||
                            (cleanValue.startsWith("'") && cleanValue.endsWith("'"))) {
                            cleanValue = cleanValue.slice(1, -1);
                        }
                        // Gérer les arrays JSON
                        if (cleanValue.startsWith('[') && cleanValue.endsWith(']')) {
                            try {
                                cleanValue = JSON.parse(cleanValue).join(', ');
                            } catch (e) {
                                cleanValue = cleanValue.slice(1, -1);
                            }
                        }
                        metadata[key] = cleanValue;
                    }
                }
            });
            
            console.log('Front matter parsé:', metadata);
            return { metadata, content: content.trim() };
        }

        // Mettre à jour le contenu de la page
        function updateContent(articleId, metadata, htmlContent) {
            // Breadcrumb
            const breadcrumb = document.querySelector('.breadcrumb');
            breadcrumb.innerHTML = `
                <a href="#" onclick="loadMarkdownArticle('windows-server')" class="breadcrumb-item">Accueil</a>
                <span class="breadcrumb-separator">›</span>
                <span class="breadcrumb-item active">${metadata.title || 'Article'}</span>
            `;
            
            // En-tête du contenu
            const contentHeader = document.querySelector('.content-header');
            const title = metadata.title || 'Article';
            const category = metadata.category || 'Documentation';
            const readingTime = metadata.reading_time || '';
            const lastUpdated = metadata.last_updated || '';
            const author = metadata.author || '';
            
            contentHeader.innerHTML = `
                <h1>${title}</h1>
                <div class="meta">
                    <span class="badge">${category}</span>
                    ${readingTime ? `<span class="meta-item">📖 ${readingTime}</span>` : ''}
                    ${lastUpdated ? `<span class="meta-item">🔄 Mis à jour le ${lastUpdated}</span>` : ''}
                    ${author ? `<span class="meta-item">👤 ${author}</span>` : ''}
                </div>
            `;
            
            // Contenu principal
            const contentDiv = document.querySelector('.content');
            const processedContent = processMarkdownHTML(htmlContent);
            contentDiv.innerHTML = processedContent;
            
            // Mettre à jour le titre de la page
            document.title = `${title} - Wiki Sysadmin`;
            
            // Re-appliquer Prism.js
            if (typeof Prism !== 'undefined') {
                Prism.highlightAll();
            }
        }

        // Traiter le HTML généré par Markdown
        function processMarkdownHTML(html) {
            // Ajouter des classes aux blockquotes
            html = html.replace(/<blockquote>/g, '<blockquote class="note">');
            
            // Traiter les blockquotes avec type
            html = html.replace(/<blockquote class="note"><p><strong>(Attention|Warning|Avertissement):<\/strong>/g, 
                '<blockquote class="warning"><p><strong>$1:</strong>');
            html = html.replace(/<blockquote class="note"><p><strong>(Info|Information):<\/strong>/g, 
                '<blockquote class="info"><p><strong>$1:</strong>');
            html = html.replace(/<blockquote class="note"><p><strong>(Conseil|Tip):<\/strong>/g, 
                '<blockquote class="tip"><p><strong>$1:</strong>');
            
            return html;
        }

        // Mettre à jour l'élément actif dans la navigation
        function updateActiveNavItem(articleId) {
            // Supprimer toutes les classes active
            document.querySelectorAll('.nav-link, .submenu-item').forEach(link => {
                link.classList.remove('active');
            });
            
            // Ajouter la classe active au lien correspondant
            const targetLink = document.querySelector(`[onclick*="${articleId}"]`);
            if (targetLink) {
                targetLink.classList.add('active');
                
                // Si c'est un sous-menu, ouvrir le menu parent
                const parentSubmenu = targetLink.closest('.submenu');
                if (parentSubmenu) {
                    parentSubmenu.classList.add('expanded');
                    const toggle = parentSubmenu.parentElement.querySelector('.nav-toggle');
                    if (toggle) toggle.textContent = '▲';
                }
            }
        }

        // Mettre à jour l'URL
        function updateUrl(articleId) {
            const newUrl = new URL(window.location);
            newUrl.searchParams.set('article', articleId);
            window.history.pushState({}, '', newUrl);
        }

        // Afficher un message d'erreur
        function showErrorMessage(message) {
            const contentDiv = document.querySelector('.content');
            contentDiv.innerHTML = `
                <div style="color: red; padding: 20px; border: 1px solid red; border-radius: 8px; background: #fef2f2;">
                    <h3>❌ Erreur</h3>
                    <p>${message}</p>
                </div>
            `;
        }

        // Fonction de recherche
        function performSearch(query) {
            console.log(`🔍 Recherche lancée pour: "${query}"`);
            
            if (query.length < 2) {
                console.log('❌ Requête trop courte, masquage des résultats');
                hideSearchResults();
                return;
            }

            query = query.toLowerCase().trim();
            const results = [];
            console.log(`📝 Recherche dans ${Object.keys(searchIndex).length} articles...`);

            // Rechercher dans l'index
            Object.entries(searchIndex).forEach(([articleId, data]) => {
                let score = 0;
                const searchText = `${data.title} ${data.description} ${data.category} ${data.keywords} ${data.tags.join(' ')}`.toLowerCase();

                // Score basé sur la correspondance
                if (data.title.toLowerCase().includes(query)) score += 10;
                if (data.description.toLowerCase().includes(query)) score += 5;
                if (data.category.toLowerCase().includes(query)) score += 8;
                if (data.keywords.toLowerCase().includes(query)) score += 6;
                if (data.tags.some(tag => tag.toLowerCase().includes(query))) score += 7;

                // Recherche de mots individuels
                const queryWords = query.split(' ');
                queryWords.forEach(word => {
                    if (word.length > 2 && searchText.includes(word)) {
                        score += 2;
                    }
                });

                if (score > 0) {
                    results.push({
                        articleId,
                        ...data,
                        score
                    });
                }
            });

            // Trier par score décroissant
            results.sort((a, b) => b.score - a.score);
            console.log(`✅ ${results.length} résultats trouvés:`, results.map(r => ({title: r.title, score: r.score})));

            // Limiter à 8 résultats
            const limitedResults = results.slice(0, 8);
            console.log(`📋 Affichage de ${limitedResults.length} résultats`);

            displaySearchResults(limitedResults, query);
        }

        // Afficher les résultats de recherche
        function displaySearchResults(results, query) {
            console.log(`🖥️ displaySearchResults appelée avec ${results.length} résultats`);
            const searchResults = document.getElementById('searchResults');
            console.log('🎯 Element searchResults:', searchResults);
            
            if (results.length === 0) {
                searchResults.innerHTML = `
                    <div class="search-no-results">
                        Aucun résultat pour "${query}"
                    </div>
                `;
            } else {
                let html = '';
                results.forEach(result => {
                    // Highlight du terme recherché dans le titre
                    const highlightedTitle = highlightSearchTerm(result.title, query);
                    const highlightedDescription = highlightSearchTerm(result.description, query);
                    
                    html += `
                        <div class="search-result-item" onclick="selectSearchResult('${result.articleId}')">
                            <div class="search-result-title">${highlightedTitle}</div>
                            <div class="search-result-description">${highlightedDescription}</div>
                            <div class="search-result-category">${result.category}</div>
                        </div>
                    `;
                });
                searchResults.innerHTML = html;
            }
            
            searchResults.classList.add('visible');
        }

        // Highlight des termes de recherche
        function highlightSearchTerm(text, query) {
            const regex = new RegExp(`(${query})`, 'gi');
            return text.replace(regex, '<mark style="background: #fff3cd; padding: 0.125rem;">$1</mark>');
        }

        // Cacher les résultats de recherche
        function hideSearchResults() {
            const searchResults = document.getElementById('searchResults');
            searchResults.classList.remove('visible');
        }

        // Sélectionner un résultat de recherche
        function selectSearchResult(articleId) {
            hideSearchResults();
            document.getElementById('searchInput').value = '';
            loadMarkdownArticle(articleId);
        }

        // Initialiser la recherche
        function initializeSearch() {
            console.log('🔧 Initialisation de la fonction recherche...');
        const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            console.log('📍 Éléments trouvés:', {searchInput, searchResults});
        
            // Événement de saisie avec debounce
            let searchTimeout;
        searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performSearch(e.target.value);
                }, 300);
            });

            // Gestion des touches
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    hideSearchResults();
                    searchInput.blur();
                } else if (e.key === 'Enter') {
                    const firstResult = searchResults.querySelector('.search-result-item');
                    if (firstResult) {
                        const articleId = firstResult.getAttribute('onclick').match(/'([^']+)'/)[1];
                        selectSearchResult(articleId);
                    }
                }
            });

            // Cacher les résultats quand on clique ailleurs
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-box')) {
                    hideSearchResults();
                }
            });

            // Raccourci clavier Ctrl+K ou Cmd+K pour focus sur recherche
            document.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                e.preventDefault();
                    searchInput.focus();
                }
            });
        }

        // Initialisation du toggle mobile
        function initializeMobileToggle() {
        const mobileToggle = document.getElementById('mobileToggle');
        const sidebar = document.getElementById('sidebar');
        
            if (mobileToggle && sidebar) {
        mobileToggle.addEventListener('click', function() {
                    sidebar.classList.toggle('mobile-open');
                });
                
                // Fermer la sidebar quand on clique sur un lien (mobile)
                sidebar.addEventListener('click', function(e) {
                    if (e.target.matches('a') && window.innerWidth <= 768) {
                        sidebar.classList.remove('mobile-open');
                    }
                });
            }
        }

        // Initialiser les sous-menus
        function initializeSubmenus() {
            const submenuToggles = document.querySelectorAll('.nav-item.has-submenu .nav-link');
            submenuToggles.forEach(toggle => {
                toggle.addEventListener('click', function(e) {
                e.preventDefault();
                    const navItem = this.parentElement;
                    const submenu = navItem.querySelector('.submenu');
                    const toggleIcon = this.querySelector('.nav-toggle');
                    
                    if (submenu.classList.contains('expanded')) {
                        submenu.classList.remove('expanded');
                        toggleIcon.textContent = '▼';
                    } else {
                        submenu.classList.add('expanded');
                        toggleIcon.textContent = '▲';
                }
            });
        });
        }

        // Gestion du bouton retour/avancer du navigateur
        window.addEventListener('popstate', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const articleId = urlParams.get('article') || 'sysadmin-windows-server';
            loadAutoMarkdownArticle(articleId);
        });

        // 🎯 INITIALISATION AUTOMATIQUE DU NOUVEAU SYSTÈME
        async function initializeAutoSystem() {
            console.log('🚀 Initialisation du système auto-découverte...');
            
            try {
                // 1. Découvrir tous les articles
                await discoverArticles();
                
                // 2. Générer la sidebar automatiquement
                generateSidebar();
                
                // 3. Initialiser les autres composants
                initializeMobileToggle();
                initializeSubmenus();
                initializeAutoSearch();
                
                // 4. Charger l'article par défaut
                const urlParams = new URLSearchParams(window.location.search);
                const articleId = urlParams.get('article') || 'sysadmin-windows-server';
                await loadAutoMarkdownArticle(articleId);
                
                console.log('✅ Système auto-découverte initialisé avec succès !');
                
            } catch (error) {
                console.error('❌ Erreur lors de l\'initialisation du système auto:', error);
            }
        }

        // 🔍 INITIALISATION RECHERCHE AUTO
        function initializeAutoSearch() {
            console.log('🔧 Initialisation de la recherche automatique...');
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.getElementById('searchResults');
            console.log('📍 Éléments trouvés:', {searchInput, searchResults});

            if (!searchInput) {
                console.error('❌ searchInput non trouvé');
                return;
            }

            // Événement de saisie avec debounce
            let searchTimeout;
            searchInput.addEventListener('input', function(e) {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    performAutoSearch(e.target.value);
                }, 300);
            });

            // Gestion des touches
            searchInput.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    hideSearchResults();
                    searchInput.blur();
                } else if (e.key === 'Enter') {
                    const firstResult = searchResults?.querySelector('.search-result-item');
                    if (firstResult) {
                        const articleId = firstResult.getAttribute('onclick')?.match(/'([^']+)'/)?.[1];
                        if (articleId) {
                            selectAutoSearchResult(articleId);
                        }
                    }
                }
            });

            // Masquer les résultats au clic extérieur
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && (!searchResults || !searchResults.contains(e.target))) {
                    hideSearchResults();
                }
            });

            console.log('✅ Recherche automatique initialisée');
        }

        // Sélectionner un résultat de recherche
        function selectAutoSearchResult(articleId) {
            console.log(`🎯 Sélection résultat: ${articleId}`);
            hideSearchResults();
            document.getElementById('searchInput').value = '';
            loadAutoMarkdownArticle(articleId);
        }

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 Chargement de la page - Lancement du système auto-découverte...');
            initializeAutoSystem();
        });
    </script>
</body>
</html>